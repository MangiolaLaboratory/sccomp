<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Main Function for SCCOMP Estimate — sccomp_estimate • sccomp</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Main Function for SCCOMP Estimate — sccomp_estimate"><meta property="og:description" content="The sccomp_estimate function performs linear modeling on a table of cell counts,
which includes a cell-group identifier, sample identifier, integer count, and factors
(continuous or discrete). The user can define a linear model with an input R formula,
where the first factor is the factor of interest. Alternatively, sccomp accepts
single-cell data containers (e.g., Seurat, SingleCellExperiment, cell metadata, or
group-size) and derives the count data from cell metadata."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sccomp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.7.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction.html">Overview of the sccomp package</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/stemangiola/sccomp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Main Function for SCCOMP Estimate</h1>
    <small class="dont-index">Source: <a href="https://github.com/stemangiola/sccomp/blob/HEAD/R/methods.R" class="external-link"><code>R/methods.R</code></a></small>
    <div class="hidden name"><code>sccomp_estimate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>sccomp_estimate</code> function performs linear modeling on a table of cell counts,
which includes a cell-group identifier, sample identifier, integer count, and factors
(continuous or discrete). The user can define a linear model with an input R formula,
where the first factor is the factor of interest. Alternatively, <code>sccomp</code> accepts
single-cell data containers (e.g., Seurat, SingleCellExperiment, cell metadata, or
group-size) and derives the count data from cell metadata.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sccomp_estimate</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  formula_composition <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  formula_variability <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  <span class="va">.sample</span>,</span>
<span>  <span class="va">.cell_group</span>,</span>
<span>  .count <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cores <span class="op">=</span> <span class="fu">detectCores</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  bimodal_mean_variability_association <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  percent_false_positive <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  variational_inference <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prior_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, coefficients <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior_overdispersion_mean_association <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>, slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>    standard_deviation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  .sample_cell_group_pairs_to_exclude <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  enable_loo <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  noise_model <span class="op">=</span> <span class="st">"multi_beta_binomial"</span>,</span>
<span>  exclude_priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mcmc_seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1e+05</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  max_sampling_iterations <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  pass_fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  approximate_posterior_inference <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.data</dt>
<dd><p>A tibble including cell_group name column, sample name column,
read counts column (optional depending on the input class), and factor columns.</p></dd>


<dt>formula_composition</dt>
<dd><p>A formula describing the model for differential abundance.</p></dd>


<dt>formula_variability</dt>
<dd><p>A formula describing the model for differential variability.</p></dd>


<dt>.sample</dt>
<dd><p>A column name as symbol for the sample identifier.</p></dd>


<dt>.cell_group</dt>
<dd><p>A column name as symbol for the cell_group identifier.</p></dd>


<dt>.count</dt>
<dd><p>A column name as symbol for the cell_group abundance (read count).</p></dd>


<dt>cores</dt>
<dd><p>Number of cores to use for parallel calculations.</p></dd>


<dt>bimodal_mean_variability_association</dt>
<dd><p>Boolean for modeling mean-variability as bimodal.</p></dd>


<dt>percent_false_positive</dt>
<dd><p>Real number between 0 and 100 for outlier identification.</p></dd>


<dt>variational_inference</dt>
<dd><p>Boolean for using variational Bayes for posterior inference. It is faster and convenient. Setting this argument to FALSE runs the full Bayesian (Hamiltonian Monte Carlo) inference, slower but it is the gold standard.</p></dd>


<dt>prior_mean</dt>
<dd><p>List with prior knowledge about mean distribution, they are the intercept and coefficient.</p></dd>


<dt>prior_overdispersion_mean_association</dt>
<dd><p>List with prior knowledge about mean/variability association.</p></dd>


<dt>.sample_cell_group_pairs_to_exclude</dt>
<dd><p>Column name with boolean for sample/cell-group pairs exclusion.</p></dd>


<dt>verbose</dt>
<dd><p>Boolean to print progression.</p></dd>


<dt>enable_loo</dt>
<dd><p>Boolean to enable model comparison using the LOO package.</p></dd>


<dt>noise_model</dt>
<dd><p>Character string for the noise model (e.g., 'multi_beta_binomial').</p></dd>


<dt>exclude_priors</dt>
<dd><p>Boolean to run a prior-free model.</p></dd>


<dt>use_data</dt>
<dd><p>Boolean to run the model data-free.</p></dd>


<dt>mcmc_seed</dt>
<dd><p>Integer for MCMC reproducibility.</p></dd>


<dt>max_sampling_iterations</dt>
<dd><p>Integer to limit maximum iterations for large datasets.</p></dd>


<dt>pass_fit</dt>
<dd><p>Boolean to include the Stan fit as attribute in the output.</p></dd>


<dt>approximate_posterior_inference</dt>
<dd><p>DEPRECATED please use the <code>variational_inference</code> argument.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A nested tibble <code>tbl</code>, with the following columns</p><ul><li><p>cell_group - column including the cell groups being tested</p></li>
<li><p>parameter - The parameter being estimated, from the design matrix dscribed with the input formula_composition and formula_variability</p></li>
<li><p>factor - The factor in the formula corresponding to the covariate, if exists (e.g. it does not exist in case og Intercept or contrasts, which usually are combination of parameters)</p></li>
<li><p>c_lower - lower (2.5%) quantile of the posterior distribution for a composition (c) parameter.</p></li>
<li><p>c_effect - mean of the posterior distribution for a composition (c) parameter.</p></li>
<li><p>c_upper - upper (97.5%) quantile of the posterior distribution fo a composition (c)  parameter.</p></li>
<li><p>c_pH0 - Probability of the null hypothesis (no difference) for  a composition (c). This is not a p-value.</p></li>
<li><p>c_FDR - False-discovery rate of the null hypothesis (no difference) for  a composition (c).</p></li>
<li><p>c_n_eff - Effective sample size - the number of independent draws in the sample, the higher the better (mc-stan.org/docs/2_25/cmdstan-guide/stansummary.html).</p></li>
<li><p>c_R_k_hat - R statistic, a measure of chain equilibrium, should be within 0.05 of 1.0 (mc-stan.org/docs/2_25/cmdstan-guide/stansummary.html).</p></li>
<li><p>v_lower - Lower (2.5%) quantile of the posterior distribution for a variability (v) parameter</p></li>
<li><p>v_effect - Mean of the posterior distribution for a variability (v) parameter</p></li>
<li><p>v_upper - Upper (97.5%) quantile of the posterior distribution for a variability (v) parameter</p></li>
<li><p>v_pH0 - Probability of the null hypothesis (no difference) for a variability (v). This is not a p-value.</p></li>
<li><p>v_FDR - False-discovery rate of the null hypothesis (no difference), for a variability (v).</p></li>
<li><p>v_n_eff - Effective sample size for a variability (v) parameter - the number of independent draws in the sample, the higher the better (mc-stan.org/docs/2_25/cmdstan-guide/stansummary.html).</p></li>
<li><p>v_R_k_hat - R statistic for a variability (v) parameter, a measure of chain equilibrium, should be within 0.05 of 1.0 (mc-stan.org/docs/2_25/cmdstan-guide/stansummary.html).</p></li>
<li><p>count_data Nested input count data.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"counts_obj"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">estimate</span> <span class="op">=</span></span></span>
<span class="r-in"><span>  <span class="fu">sccomp_estimate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">counts_obj</span> ,</span></span>
<span class="r-in"><span>   <span class="op">~</span> <span class="va">type</span>,</span></span>
<span class="r-in"><span>   <span class="op">~</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>   <span class="va">sample</span>,</span></span>
<span class="r-in"><span>   <span class="va">cell_group</span>,</span></span>
<span class="r-in"><span>   <span class="va">count</span>,</span></span>
<span class="r-in"><span>    cores <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> sccomp says: count column is an integer. The sum-constrained beta binomial model will be used</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> sccomp says: estimation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> sccomp says: the composition design matrix has columns: (Intercept), typecancer</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> sccomp says: the variability design matrix has columns: (Intercept)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: ------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: EXPERIMENTAL ALGORITHM:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   This procedure has not been thoroughly tested and may be unstable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   or buggy. The interface is subject to change.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: ------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Gradient evaluation took 0.000314 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 3.14 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Begin eta adaptation.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:   1 / 250 [  0%]  (Adaptation)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:  50 / 250 [ 20%]  (Adaptation)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 100 / 250 [ 40%]  (Adaptation)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 150 / 250 [ 60%]  (Adaptation)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 200 / 250 [ 80%]  (Adaptation)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 250 / 250 [100%]  (Adaptation)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Success! Found best value [eta = 0.1].</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Begin stochastic gradient ascent.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    100        -4873.930             1.000            1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    200        -4345.614             0.561            1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    300        -4151.689             0.389            0.122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    400        -4007.191             0.301            0.122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    500        -3937.252             0.244            0.047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    600        -3880.822             0.206            0.047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    700        -3833.754             0.178            0.036</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    800        -3809.119             0.157            0.036</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:    900        -3779.277             0.140            0.018</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   1000        -3760.398             0.127            0.018</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   1100        -3743.666             0.027            0.015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   1200        -3727.673             0.016            0.012</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:   1300        -3717.491             0.011            0.008   MEDIAN ELBO CONVERGED</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Drawing a sample of size 4000 from the approximate posterior... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: COMPLETED.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stefano Mangiola.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

